version: 2.1

jobs:
  base_test:
    parameters:
      image:
        type: string
      test:
        type: string

    docker:
      - image: << parameters.image >>

    steps:
      - checkout
      - run: python --version
      - run: python runtest.py --verbose=3 -f .circleci/<< parameters.test >> -j 2 || if [[ $? == 2 ]]; then true; else false; fi

  machine_test:
    parameters:
      os:
        type: executor
      test:
        type: string

    executor: << parameters.os >>

    steps:
      - checkout
      - run: python --version
      - run: python runtest.py --verbose=3 -f .circleci/<< parameters.test >> -j 2 || if [[ $? == 2 ]]; then true; else false; fi

workflows:
  all_tests:
    jobs:
      - base_test:
          matrix:
            parameters:
              image: ['python:3.8', 'python:3.7']
              test: ['base_docker_tests.txt', 'base_tests.txt']
      - machine_test:
          matrix:
            parameters:
              os: [machine]
              test: ['base_machine_tests.txt']